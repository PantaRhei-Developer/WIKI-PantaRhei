# 目次

0. [結論](#結論)
1. [概要](#概要)
2. [ワークログ](#ワークログ)
    1. [GKEを導入する場合](#gkeを導入する場合)
    2. [Cloud Runを導入する場合](#cloud-runを導入する場合)
    3. [選択肢の比較](#選択肢の比較)

# 0. 結論
Cloud RunではコンテナごとにIPアドレスを割り振ることはできなさそうだ．GKEでは，ポッドとコンテナを１対１対応させれば可能そうだが，実装の形がきれいではなさそう．

1. 概要

[INTERN-240: Cloud Runもしくは，GKEで週次バッチスクレイピングが実装可能か調査完了](https://remotesalesproject.atlassian.net/browse/INTERN-240)

[GKE における IP アドレス管理の理解 | Google Cloud 公式ブログ ](https://cloud.google.com/blog/ja/products/containers-kubernetes/ip-address-management-in-gke)

[GCPの二大サービスを解剖：GKEとCloud Runの違いとは (2023.JUNE.3rd, with ChatGPT-4)｜noise ](https://note.com/noise_net/n/n11eb2f293abf)

[Google Kubernetes Engine（GKE） ](https://cloud.google.com/kubernetes-engine?hl=ja)

[Kubernetes ”Pod”と”ノード”の違い ](https://dev.appswingby.com/kubernetes/kubernetes-pod%E3%81%A8%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AE%E9%81%95%E3%81%84/)

[Google Kubernetes Engine のドキュメント  |  Google Kubernetes Engine（GKE）  |  Google Cloud ](https://cloud.google.com/kubernetes-engine/docs?hl=ja)

# 2. ワークログ
**GKEを導入する場合**

1.**週次バッチスクレイピングができるのか**: KubernetesのCronJobとしてスケジュールすることで，定期的にスクレイピングを実行することが可能です．

2.**週次バッチを回すのに料金はどうか**: 週次バッチを実行するためのインスタンスやストレージなどのリソース利用に応じて料金が発生する．具体的にどれくらいかかるのかは週次バッチテストをしてみないとわからない．

3.**GKEのメリット・デメリット**:

**メリット**:

・クラスター管理が容易であり，スケーラビリティが高い．

・Kubernetesの機能を活用できるため，柔軟なデプロイメントや管理が可能．

・サービスの可用性や信頼性が高い．

**デメリット**:

・構築や管理に手間がかかる場合がある．

・定期的なスケジュールジョブの設定や管理が必要．

4.**1つのコンテナが使えなくなった時，IPアドレスだけを変えることができるかどうか**: GKEではポッド（コンテナの実行単位）にIPアドレスを割り当てることができるが，ポッドが失敗した場合に新しいIPアドレスを割り当てることはできないようだ．代わりに，新しいポッドが作成され，新しいIPアドレスが割り当てられる可能性がある．

**Cloud Runを導入する場合**

1.**週次バッチスクレイピングができるのか**: 外部のスケジューラやCI/CDツールを使用し，定期的なリクエストをトリガーにすることで，Cloud Runでも週次バッチスクレイピングを実行することは可能．

2.**週次バッチを回すのに料金はどうか**: Cloud Runはリクエスト数や実行時間に応じて課金される．週次バッチの実行に必要なリソース量に応じて料金が発生するとのこと．これも具体的にはテストしてみないとわからない．

3.**Cloud Runのメリット・デメリット**:

**メリッ**ト:

・インフラストラクチャの管理が不要で，簡単にデプロイできる．

・リクエストに応じてスケーリングされるため，コスト効率が高い．

・サービスの管理が容易．

**デメリット**:

・スケジュールジョブの直接的なサポートがない．

・イメージの起動時間が長い場合があり，それが実行に影響を与える可能性がある．

4.1つのコンテナが使えなくなった時，IPアドレスだけを変えることができるかどうか: Cloud Runでは，アプリケーションがスケーリングされるため，個々のコンテナのIPアドレスを操作することはできない．代わりに，Googleが管理するロードバランサーがトラフィックを各コンテナに適切にルーティングするとのこと．（よく理解できていない…）

**選択肢の比較**

・**GKEを選択する場合**:

IPアドレスはポッドごとに付与されるため，ポッドとコンテナを1対1対応させる必要がありそう．

・**Cloud Runを選択する場合**:

コンテナごとにIPアドレスを付与することはできないため，エンジンサービスにプロキシサーバを立てることが必要がありそう．
